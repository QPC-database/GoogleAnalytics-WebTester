<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="description" content="A Protractor application to test and validate the proper Google Analytics Tracking implementation of a website. Compatible with Google Tag Manager." />
    <meta name="author" content="Philippe Sawicki" />

    <meta name="google-site-verification" content="ctAoEcOP_KOarL1L7ifRAxRMYKDZk-YK2LQcvcfLJEs" />

    <title>Google Analytics Web Tester by Philippe Sawicki</title>

    <!--<link rel="stylesheet" type="text/css" href='https://fonts.googleapis.com/css?family=Architects+Daughter'>-->
    <link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/css?family=Open+Sans:300">
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/pygment_trac.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print">
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/styles/monokai_sublime.min.css">


    <style type="text/css">
      pre {
        padding: 0;
        border: 0;
        margin-bottom: 5px;
        background: transparent;
      }
      pre code {
        margin-bottom: 5px;
      }


      .slideshow-container {
        /*width: 690px;*/width: 100%;
        height: 521px;
        overflow: hidden;
        position: relative;
      }

      @keyframes round {
        25% { opacity: 1; }
        40% { opacity: 0; }
      } 
      @-webkit-keyframes round {
        25% { opacity: 1; }
        40% { opacity: 0; }
      }

      .photo {
        position: absolute;
        -webkit-animation: round 15s infinite;
                animation: round 15s infinite;
        opacity: 0;
      }
      .photo:nth-child(3) { animation-delay:  0s; -webkit-animation-delay:  0s; }
      .photo:nth-child(2) { animation-delay:  5s; -webkit-animation-delay:  5s; }
      .photo:nth-child(1) { animation-delay: 10s; -webkit-animation-delay: 10s; }

      /* Mobile Portrait Size to Mobile Landscape Size (devices and browsers) */
      @media only screen and (max-width: 479px) {
        .slideshow-container {
          height: 225px;
        }
      }
      /* Mobile Landscape Size to Tablet Portrait (devices and browsers) */
      @media only screen and (min-width: 480px) and (max-width: 767px) {
        .slideshow-container {
          height: 291px;
        }
      }
    </style>

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>

  <body>
  
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
        ga('create', {
            trackingId: 'UA-60737019-3',
            cookieDomain: location.hostname === 'localhost' ? 'none' : 'auto', 
            siteSpeedSampleRate: 100
        });
        ga('require', 'displayfeatures');
        ga('send', 'pageview');
    </script>
  
    <header>
      <div class="inner">
        <h1>Google Analytics Web Tester</h1>
        <h2>A testing tool to validate Google Analytics implementation on a website</h2>
        <a href="https://github.com/philsawicki/GoogleAnalytics-WebTester" class="button" id="githubSite" title="View Google Analytics Website Checker project on Github"><small>View project on</small> GitHub</a>
      </div>
    </header>

    <div id="content-wrapper">
      <div class="inner clearfix">
        <section id="main-content">
          <p>
            <a href="https://travis-ci.org/philsawicki/GoogleAnalytics-WebTester"><img src="https://travis-ci.org/philsawicki/GoogleAnalytics-WebTester.svg?branch=master" alt="Build Status"></a>
            <a href="https://coveralls.io/r/philsawicki/GoogleAnalytics-WebTester?branch=master"><img src="https://coveralls.io/repos/philsawicki/GoogleAnalytics-WebTester/badge.svg?branch=master" alt="Coverage Status" /></a>
            <a href="https://david-dm.org/philsawicki/GoogleAnalytics-WebTester"><img src="https://david-dm.org/philsawicki/GoogleAnalytics-WebTester.svg" alt="Dependency Status"></a>
            <a href="https://david-dm.org/philsawicki/GoogleAnalytics-WebTester#info=devDependencies"><img src="https://david-dm.org/philsawicki/GoogleAnalytics-WebTester/dev-status.svg" alt="devDependency Status"></a>
          </p>

<h2><a id="google-analytics-web-tester" class="anchor" href="#google-analytics-web-tester" aria-hidden="true"><span class="octicon octicon-link"></span></a>Google Analytics Web Tester</h2>

<blockquote>
<p>Live, continuous audit of Google Analytics implementations</p>
</blockquote>

<p>Testing proper implementation of Google Analytics Tracking on a website can be a tricky thing to do. Unless you run a daily gamut of tests, what works one day may be broken the next one without you ever noticing.</p>

<p>But it doesn't have to be that way.</p>

<hr>



<p>This library eases the process of writing automated tests by providing a set of easy to use utility methods. It comes with an AngularJS demo application to show how to validate that the <code>ga()</code> snippet receives the expected data when the user interacts with the page.</p>

<p>Whether using the Google Analytics snippet directly (<code>ga()</code>) or Google Tag Manager, all tracking interactions can be recorded the exact same way:</p>

<ul>
  <li><strong>Pageviews</li>
  <li>Custom Events</li>
  <li>Custom Metrics / Dimensions</li>
  <li>Enhanced E-Commerce</li>
  <li>Social Interactions</li>
  <li>Timings</li>
  <li>etc.</strong></li>
</ul>

<p>Just set the URL of your website, write a couple of specs and run the app, or set it to run after each build/deployment.</p>

<p>Easy!</p>

<h2>
<a id="preview" class="anchor" href="#preview" aria-hidden="true"><span class="octicon octicon-link"></span></a>Preview</h2>

<p>The Demo Application contains a few pages that illustrate the most common uses cases for a website, with Event tracking on the Homepage and the Blog, and Enhanced E-Commerce tracking on a <em>Featured Products</em> slideshow. It features pages using direct <code>ga()</code> calls and others using Google Tag Manager in order to demonstrate both cases.</p>

<p>Here's what it looks like:
<div class="slideshow-container">
  <img src="http://i.imgur.com/cpGonzw.png" alt="Google Analytics Web Tester Demo Application" title="Google Analytics Web Tester Demo Application - Homepage" class="photo">
  <img src="http://i.imgur.com/ngiHYoE.png" alt="Google Analytics Web Tester Demo Application" title="Google Analytics Web Tester Demo Application - Blog page" class="photo">
  <img src="http://i.imgur.com/dkaaUrz.png" alt="Google Analytics Web Tester Demo Application" title="Google Analytics Web Tester Demo Application - Add to Cart page" class="photo">
</div>

</p>

<h2>
<a id="how-does-it-work" class="anchor" href="#how-does-it-work" aria-hidden="true"><span class="octicon octicon-link"></span></a>How does it work?</h2>

<p>The library uses the <a href="http://angular.github.io/protractor/#/" title="Protractor">Protractor</a> test runner and <a href="http://jasmine.github.io/" title="Jasmine">Jasmine</a>'s BDD notation to execute End-to-End (E2) tests in real browsers (Chrome, Firefox, Safari, IE, PhantomJS, etc.). </p>

<p>It's fast, lightweight, easy to configure, and integrates beautifully with existing build systems, providing nice integration reports with Jenkins, Travis CI and many others.</p>

<h3>
<a id="sample-spec-file" class="anchor" href="#sample-spec-file" aria-hidden="true"><span class="octicon octicon-link"></span></a>Sample Spec file</h3>

<pre><code class="javascript">describe('Google Analytics "click" tracking', function () {
   beforeEach(function () {
      // Load the page to test:
      browser.get('index.html');

      // Register the Google Analytics Event Data Interceptor:
      browser.driver.registerGoogleAnalyticsEventDataInterceptor();
   });

   it('should fire an Event when clicking on the Jumbotron CTA', function (done) {
      // Click on the "Jumbotron" CTA:
      element( by.css('#jumbotronCTA') ).click();

      // Get the "LastEvent" object back from the browser:
      browser.driver.executeScript(function () {
         return window.GAWebTester.getLastEvent();
      })
      .then(
         // Validate the content of the "LastEvent" object:
         function successCallback (LastEvent) {
            expect( LastEvent ).toEqual( ['send', 'event', 'Button', 'Click', 'Jumbotron CTA'] );
         },
         // If there was an error getting back the "LastEvent" object from the browser, fail the test:
         function errorCallback (error) {
            fail('Should not have received Error: ' + JSON.stringify(error));
         }
      )
      .then(done);
   });
});</code></pre>

<p>Or, if you find the syntax too verbose and you feel confident, you can always use the condensed version:</p>

<pre><code class="javascript">describe('Google Analytics "click" tracking', function () {
   beforeEach(function () {
      // Load the page to test:
      browser.get('index.html');

      // Register the Google Analytics Event Data Interceptor:
      browser.driver.registerGoogleAnalyticsEventDataInterceptor();
   });

   it('should fire an Event when clicking on the Jumbotron CTA', function (done) {
      // Click on the "Jumbotron" CTA:
      element( by.css('#jumbotronCTA') ).click();

      // Get the "LastEvent" object back from the browser and validate its data:
      browser.driver.executeScript(function () { return window.GAWebTester.getLastEvent(); })
      .then(function (LastEvent) {
         expect( LastEvent ).toEqual( ['send', 'event', 'Button', 'Click', 'Jumbotron CTA'] );
         done();
      });
   });
});</code></pre>

<h3>
<a id="getting-the-google-analytics-event-data" class="anchor" href="#getting-the-google-analytics-event-data" aria-hidden="true"><span class="octicon octicon-link"></span></a>Getting the Google Analytics Event data</h3>

<h4>
<a id="base-mechanics" class="anchor" href="#base-mechanics" aria-hidden="true"><span class="octicon octicon-link"></span></a>Base mechanics</h4>

<p>How do you know which Event structure to expect in order to write your tests?</p>

<p>Let's say your standard <code>ga()</code> call looks like this when clicking on the <em>Jumbotron CTA</em> of the demo application (will be the same if Event Tracking is set through GTM*):</p>

<pre><code class="javascript">ga('send', 'event', 'Button', 'Click', 'Jumbotron CTA');
    │       │        │         │        └──> 5. Event Label
    │       │        │         └───────────> 4. Event Action
    │       │        └─────────────────────> 3. Event Category
    │       └──────────────────────────────> 2. (Standard Google Analytics parameter)
    └──────────────────────────────────────> 1. (Standard Google Analytics parameter)</code></pre>

<p>Then, after the <code>ga()</code> is executed, the value of <code>window.gaLastEventData</code> will be:</p>

<pre><code class="javascript">  ['send', 'event', 'Button', 'Click', 'Jumbotron CTA']
    │       │        │         │        └──> 5. Event Label
    │       │        │         └───────────> 4. Event Action
    │       │        └─────────────────────> 3. Event Category
    │       └──────────────────────────────> 2. (Standard Google Analytics parameter)
    └──────────────────────────────────────> 1. (Standard Google Analytics parameter)</code></pre>

<p>You then just need to use the Jasmine-provided matchers to make sure that the actual value of <code>window.gaLastEventData</code> is the same as the expected one.</p>

<p>*: <em>If using Event tracking through Google Tag Manager (GTM), then the Container will generate some JavaScript exactly matching the pattern of the <code>ga()</code> call above. Just add the <code>send</code> and <code>event</code> values to the Array.</em></p>

<h4>
<a id="data-structure-for-pageviews-metrics--dimensions-enhanced-e-commerce-etc" class="anchor" href="#data-structure-for-pageviews-metrics--dimensions-enhanced-e-commerce-etc" aria-hidden="true"><span class="octicon octicon-link"></span></a>Data Structure for Pageviews, Metrics / Dimensions, Enhanced E-Commerce, etc.</h4>

<p>Just follow the same pattern as above for <a href="https://developers.google.com/analytics/devguides/collection/analyticsjs/field-reference#customs" title="Pageviews">Pageviews</a>, <a href="https://developers.google.com/analytics/devguides/collection/analyticsjs/field-reference#customs" title="Custom Metrics / Dimensions">Custom Metrics &amp; Dimensions</a>, <a href="https://developers.google.com/analytics/devguides/collection/analyticsjs/field-reference#enhanced-ecomm" title="Enhanced E-Commerce">Enhanced E-Commerce</a>, <a href="https://developers.google.com/analytics/devguides/collection/analyticsjs/field-reference#social" title="Social Interactions">Social Interactions</a>, <a href="https://developers.google.com/analytics/devguides/collection/analyticsjs/field-reference#timing" title="Timings">Timings</a> or any other <code>ga()</code> call:</p>

<h5>
<a id="pageviews" class="anchor" href="#pageviews" aria-hidden="true"><span class="octicon octicon-link"></span></a>Pageviews:</h5>

<pre><code class="javascript">  ['send', 'pageview']
    │       └──────────────────────────────> 2. (Standard Google Analytics parameter)
    └──────────────────────────────────────> 1. (Standard Google Analytics parameter)</code></pre>

<h5>
<a id="custom-metrics--dimensions" class="anchor" href="#custom-metrics--dimensions" aria-hidden="true"><span class="octicon octicon-link"></span></a>Custom Metrics / Dimensions:</h5>

<pre><code class="javascript">  ['set', 'metric1', '123']
    │      │          └────────────────────> 3. Metric Value
    │      └───────────────────────────────> 2. Metric Index
    └──────────────────────────────────────> 1. (Standard Google Analytics parameter)
  
  ['set', 'dimension1', 'Visitor']
    │      │             └─────────────────> 3. Dimension Value
    │      └───────────────────────────────> 2. Dimension Index
    └──────────────────────────────────────> 1. (Standard Google Analytics parameter)</code></pre>

<h5>
<a id="enhanced-e-commerce" class="anchor" href="#enhanced-e-commerce" aria-hidden="true"><span class="octicon octicon-link"></span></a>Enhanced E-Commerce:</h5>

<pre><code class="javascript">  ['ec:addProduct', { ─────────────────────> 1. (Standard Google Analytics parameters)
     'id': 'P12345', ──────────────────────> 2. Product ID
     'name': 'Android Warhol T-Shirt', ────> 3. Product Name
     'category': 'Apparel', ───────────────> 4. Product Category
     'brand': 'Google', ───────────────────> 5. Product Brand
     'variant': 'black', ──────────────────> 6. Product Variant
     'price': '29.20', ────────────────────> 7. Product Price
     'quantity': 1   ──────────────────────> 8. Product quantity
  }]
  
  ['ec:setAction', 'checkout', { ──────────> 1&2. (Standard Google Analytics parameters)
     'step': 1, ───────────────────────────> 3. Checkout Step
     'option': 'MasterCard' ───────────────> 4. Checkout Option
  }]</code></pre>

<h5>
<a id="social-interactions" class="anchor" href="#social-interactions" aria-hidden="true"><span class="octicon octicon-link"></span></a>Social Interactions:</h5>

<pre><code class="javascript">  ['send', 'social', { ────────────────────> 1&2. (Standard Google Analytics parameters)
     'socialNetwork': 'Facebook', ─────────> 3. Social Interaction Network
     'socialAction': 'Like', ──────────────> 4. Social Interaction Action
     'socialTarget': 'http://test.com' ────> 5. Social Interaction Target (URL)
  }]</code></pre>

<h5>
<a id="timings" class="anchor" href="#timings" aria-hidden="true"><span class="octicon octicon-link"></span></a>Timings:</h5>

<pre><code class="javascript">  ['send', 'timing', { ────────────────────> 1&2. (Standard Google Analytics parameters)
     'timingCategory': 'External Libs', ───> 3. Timing Category
     'timingVar': 'Load Time', ────────────> 4. Timing Variable
     'timingValue': 123, ──────────────────> 5. Timing Value (in ms)
     'timingLabel': 'jQuery' ──────────────> 6. Timing Label
  }]</code></pre>

<h2>
<a id="installing-the-library" class="anchor" href="#installing-the-library" aria-hidden="true"><span class="octicon octicon-link"></span></a>Installing the Library</h2>

<p>To get started, simply clone this repository and install the dependencies:</p>

<pre><code class="bash">git clone https://github.com/philsawicki/GoogleAnalytics-WebTester.git
cd GoogleAnalytics-WebTester
npm install
</code></pre>

<h2>
<a id="running-the-demo-application" class="anchor" href="#running-the-demo-application" aria-hidden="true"><span class="octicon octicon-link"></span></a>Running the Demo Application</h2>

<p>The project comes preconfigured with a simple web server. If you want, you can check the demo by opening up a browser and heading over to <code>http://localhost:8000/dist/index.html#/</code>.</p>

<pre><code class="bash">npm start
npm run protractor
</code></pre>

<p>The tests should now run, and the calls to Google Analytics' <code>ga()</code> method should be intercepted and logged to the console.</p>

<h2>
<a id="contact" class="anchor" href="#contact" aria-hidden="true"><span class="octicon octicon-link"></span></a>Contact</h2>

<p>For more information, please check out <a href="http://philippesawicki.com" title="Philippe Sawicki - Fullstack Developer and Digital Analyst" rel="me">http://philippesawicki.com</a></p>
        </section>

        <aside id="sidebar">
          <a href="https://github.com/philsawicki/GoogleAnalytics-WebTester/zipball/master" class="button" id="downloadZip" title="Download Google Analytics Web Tester">
            <small>Download</small>
            .zip file
          </a>
          <a href="https://github.com/philsawicki/GoogleAnalytics-WebTester/tarball/master" class="button" id="downloadTarGz" title="Download Google Analytics Web Tester">
            <small>Download</small>
            .tar.gz file
          </a>

          <p class="repo-owner"><a href="https://github.com/philsawicki/GoogleAnalytics-WebTester" title="Google Analytics Website Checker">Google Analytics Website Tester</a> is maintained by <a href="https://github.com/philsawicki" title="Philippe Sawicki">Philippe Sawicki</a>.</p>
        </aside>
      </div>
    </div>
    
    <script type="application/ld+json">
      {
        "@context": "http://schema.org",
        "@type": "Person",
        "name": "Philippe Sawicki",
        "jobTitle": "Full Stack Developer",
        "url": "http://philippesawicki.com",
        "sameAs": [
          "https://facebook.com/philippe.sawicki",
          "https://twitter.com/fyll_s",
          "https://plus.google.com/+PhilippeSawicki",
          "https://linkedin.com/in/philippesawicki"
        ]
      }
    </script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/highlight.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/languages/javascript.min.js"></script>
    
    <script type="text/javascript">
      hljs.initHighlightingOnLoad();


      function whenReady (fn) {
        if (document.readyState != 'loading') {
          fn();
        } else {
          document.addEventListener('DOMContentLoaded', fn);
        }
      }

      whenReady(function () {
        var downloadZipLink = document.getElementById('downloadZip');
        if (downloadZipLink) {
          downloadZipLink.addEventListener('click', function (event) {
            ga('send', 'event', 'Button', 'Click', 'Download Zip File');
          });
        }

        var downloadTarGzLink = document.getElementById('downloadTarGz');
        if (downloadTarGzLink) {
          downloadTarGzLink.addEventListener('click', function (event) {
            ga('send', 'event', 'Button', 'Click', 'Download Tar.gz File');
          });
        }

        var viewOnGithub = document.getElementById('githubSite');
        if (viewOnGithub) {
          viewOnGithub.addEventListener('click', function (event) {
            ga('send', 'event', 'Button', 'Click', 'View Project on Github');
          });
        }
      });
    </script>
  </body>
</html>
